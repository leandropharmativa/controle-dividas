<!DOCTYPE html>
<html>
<head>
  <title>Controle de Dívidas</title>
  <style>
    body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    button { padding: 5px 10px; margin: 2px; }
  </style>
</head>
<body>
  <h1>Controle de Dívidas</h1>
  
  <div>
    <input type="text" id="devedorInput" placeholder="Nome do devedor">
    <input type="number" id="valorInput" placeholder="Valor">
    <button onclick="addDebt()">Adicionar Dívida</button>
  </div>

  <table id="debtsTable">
    <thead>
      <tr>
        <th>Devedor</th>
        <th>Valor</th>
        <th>Pago</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
  // Configurações da SUA planilha (já com seus dados)
  const SPREADSHEET_ID = "1gca4c0Bu_ZbhIs8ZA9rSih4o8vknjP7b-lYUdfAo6MQ";
  const API_KEY = "aizasyc6kcqpwchonauzjokj-pc8axgyyylrypu";
  
  // Função para carregar dívidas
  async function loadDebts() {
    try {
      // Acessa a aba "Dívidas!A2:G" (ajustado para sua estrutura)
      const response = await fetch(
        `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/Dívidas!A2:G?key=${API_KEY}`
      );
      
      const data = await response.json();
      const rows = data.values || [];
      
      const table = document.querySelector('#debtsTable tbody');
      table.innerHTML = rows.map(row => `
        <tr>
          <td>${row[1] || ''}</td> <!-- Coluna B - Nome -->
          <td>R$ ${parseFloat(row[2] || 0).toFixed(2)}</td> <!-- Coluna C - Valor -->
          <td>R$ ${parseFloat(row[3] || 0).toFixed(2)}</td> <!-- Coluna D - Pago -->
          <td>
            <button onclick="registerPayment('${row[0]}', ${row[2]}, ${row[3]})">
              Pagar
            </button>
          </td>
        </tr>
      `).join('');
    } catch (error) {
      console.error("Erro ao carregar:", error);
      alert("Erro ao carregar dados. Verifique o console.");
    }
  }

  // Função para registrar pagamento
  async function registerPayment(debtId, totalAmount, paidAmount) {
    const remaining = totalAmount - paidAmount;
    const paymentValue = prompt(`Valor do pagamento (Saldo: R$ ${remaining.toFixed(2)})`);
    
    if (!paymentValue || paymentValue <= 0 || paymentValue > remaining) {
      alert("Valor inválido!");
      return;
    }

    try {
      // Envia para a aba "Pagamentos!A:D"
      await fetch(
        `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/Pagamentos!A1:D1?valueInputOption=USER_ENTERED&key=${API_KEY}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            values: [
              [debtId, paymentValue, new Date().toLocaleDateString(), "Web"]
            ]
          })
        }
      );
      
      // Atualiza o valor pago na aba Dívidas
      await fetch(
        `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/Dívidas!D${parseInt(debtId)+1}?valueInputOption=USER_ENTERED&key=${API_KEY}`,
        {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            values: [[parseFloat(paidAmount) + parseFloat(paymentValue)]]
          })
        }
      );
      
      alert("Pagamento registrado!");
      loadDebts(); // Atualiza a tabela
    } catch (error) {
      console.error("Erro:", error);
      alert("Falha ao registrar. Verifique o console.");
    }
  }

  // Carrega os dados quando a página abre
  window.onload = loadDebts;
</script>
</body>
</html>
