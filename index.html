<!DOCTYPE html>
<html>
<head>
  <title>Controle de Dívidas</title>
  <style>
    body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    button { padding: 5px 10px; margin: 2px; }
  </style>
</head>
<body>
  <h1>Controle de Dívidas</h1>
  
  <div>
    <input type="text" id="devedorInput" placeholder="Nome do devedor">
    <input type="number" id="valorInput" placeholder="Valor">
    <button onclick="addDebt()">Adicionar Dívida</button>
  </div>

  <table id="debtsTable">
    <thead>
      <tr>
        <th>Devedor</th>
        <th>Valor</th>
        <th>Pago</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

 <script>
  // Configurações da sua planilha (ALTERE ESTES VALORES)
  const SPREADSHEET_ID = "https://docs.google.com/spreadsheets/d/1gca4c0Bu_ZbhIs8ZA9rSih4o8vknjP7b-lYUdfAo6MQ/edit?gid=1600298421#gid=1600298421"; // Id da sua planilha (da URL)
  const SHEET_NAME = "Dívidas"; // Nome da aba
  const API_KEY = "SAIzaSyC6KCQPwchOnAUZjOkj-pC8AxGYYYLRyPU"; // Você vai gerar no Passo 2

  // Função para carregar dívidas
  async function loadDebts() {
    try {
      const response = await fetch(
        `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${SHEET_NAME}!A2:E?key=${API_KEY}`
      );
      
      const data = await response.json();
      const debts = data.values || [];
      
      const table = document.querySelector('#debtsTable tbody');
      table.innerHTML = debts.map(row => `
        <tr>
          <td>${row[1]}</td> <!-- Devedor -->
          <td>R$ ${parseFloat(row[2]).toFixed(2)}</td> <!-- Valor Total -->
          <td>R$ ${parseFloat(row[3]).toFixed(2)}</td> <!-- Valor Pago -->
          <td>
            <button onclick="showPaymentModal('${row[0]}', ${row[2]}, ${row[3]})">
              Registrar Pagamento
            </button>
          </td>
        </tr>
      `).join('');
    } catch (error) {
      console.error("Erro ao carregar dívidas:", error);
    }
  }

  // Função para adicionar pagamento (simplificado)
  async function addPayment(debtId, amount) {
    const paymentDate = new Date().toISOString().split('T')[0];
    
    try {
      const response = await fetch(
        `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/Pagamentos!A1:append?valueInputOption=USER_ENTERED&key=${API_KEY}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            values: [[debtId, amount, paymentDate, "Online"]]
          })
        }
      );
      
      alert("Pagamento registrado com sucesso!");
      loadDebts(); // Atualiza a tabela
    } catch (error) {
      console.error("Erro ao registrar pagamento:", error);
    }
  }

  // Modal simplificado para pagamentos
  function showPaymentModal(debtId, totalAmount, paidAmount) {
    const remaining = totalAmount - paidAmount;
    const amount = prompt(`Registrar pagamento (máx: R$ ${remaining.toFixed(2)}):`);
    
    if (amount && amount > 0 && amount <= remaining) {
      addPayment(debtId, amount);
    } else {
      alert("Valor inválido!");
    }
  }

  // Carrega as dívidas quando a página abre
  window.onload = loadDebts;
</script>
</body>
</html>
